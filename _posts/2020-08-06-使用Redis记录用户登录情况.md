---
layout:     post
title:      "使用Redis记录用户登录情况"
subtitle:   ""
date:       2020-08-06 19:17:00
author:     "胡荣"
header-img: "dot-and-line"
tags:
  - 实现方案
---

今天遇到一个问题:

10万用户一年365天的登录情况如何用redis存储，并快速检索任意时间窗内的活跃用户

实现方案如下:

我们可以将单个用户一年的登录情况看为一段长达365的字符串 

若是用户在第N天登录, 那么我们将这行字符串中的第N位标记为1

那么字符串会像这样这样: 01111101101

此时使用Redis的bitmap数据结构以及相关的指令进而操作, 那么便得心应手了

1. 当用户登录时, 则使用指令 __setbit hurong 3 1__ 这样表示今年的第三天, hurong这个用户进行了登录操作
2. 当进行统计登录次数时, 则可以使用指令: __bitcount__ 从而快速得到次数
3. 当进行检索制定时间段内的活跃用户数量, 则可以使用指令: __bitop__ 进行或运算, 便可以得到活跃用于的数量

这样的场景也同样适用于签到, 打卡等场景中